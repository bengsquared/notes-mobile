(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{305:(e,t,s)=>{Promise.resolve().then(s.bind(s,2035))},2035:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>X});var a=s(8653),n=s(5321),r=s(7151),l=s(2367),i=s(3463),c=s(336);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,c.QP)((0,i.$)(t))}let d=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),m=n.forwardRef((e,t)=>{let{className:s,variant:n,size:l,asChild:i=!1,...c}=e,m=i?r.DX:"button";return(0,a.jsx)(m,{className:o(d({variant:n,size:l,className:s})),ref:t,...c})});m.displayName="Button";let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("textarea",{className:o("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...n})});x.displayName="Textarea";let u=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});u.displayName="Card";let h=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("flex flex-col space-y-1.5 p-6",s),...n})});h.displayName="CardHeader";let g=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("text-2xl font-semibold leading-none tracking-tight",s),...n})});g.displayName="CardTitle",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("text-sm text-muted-foreground",s),...n})}).displayName="CardDescription";let f=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("p-6 pt-0",s),...n})});f.displayName="CardContent",n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)("div",{ref:t,className:o("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter";var p=s(6268),N=s(9196),j=s(883),v=s(5163),y=s(2131),w=s(239),b=s(7405);let A="notes-app-data";function S(){try{let e=localStorage.getItem(A);return e?JSON.parse(e):[]}catch(e){return console.error("Error reading notes from localStorage:",e),[]}}function C(e){let{onNoteCreated:t,editingNote:s,onEditComplete:r}=e,[l,i]=(0,n.useState)(""),[c,o]=(0,n.useState)(!1),[d,h]=(0,n.useState)(null),[g,C]=(0,n.useState)(null),[R,k]=(0,n.useState)("unknown"),[E,T]=(0,n.useState)([]),z=(0,n.useRef)(null),D=(0,n.useRef)(null);(0,n.useEffect)(()=>{if(!navigator.geolocation){k("unavailable");return}s||F()},[]),(0,n.useEffect)(()=>{s&&(i(s.text),T(s.attachments),C(s.location||null),s.location&&k("granted"))},[s]);let F=()=>{if(!navigator.geolocation){k("unavailable");return}k("requesting"),navigator.geolocation.getCurrentPosition(e=>{C({lat:e.coords.latitude,lng:e.coords.longitude}),k("granted")},e=>{console.log("Location error:",e.message),k("denied"),s||C(null)},{enableHighAccuracy:!1,timeout:15e3,maximumAge:3e5})},L=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e),s=[];t.ondataavailable=e=>{s.push(e.data)},t.onstop=()=>{let t=new Blob(s,{type:"audio/webm"}),a=new FileReader;a.onload=e=>{var t;let s=null===(t=e.target)||void 0===t?void 0:t.result;T(e=>[...e,{type:"audio",data:s,name:"audio-".concat(Date.now(),".webm")}])},a.readAsDataURL(t),e.getTracks().forEach(e=>e.stop())},h(t),t.start(),o(!0)}catch(e){console.error("Error starting audio recording:",e)}},_=e=>{T(t=>t.filter((t,s)=>s!==e))};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)(u,{children:(0,a.jsxs)(f,{className:"p-4 space-y-4",children:[(0,a.jsx)(x,{placeholder:"What's on your mind?",value:l,onChange:e=>i(e.target.value),className:"min-h-32 resize-none border-0 p-0 text-base focus-visible:ring-0"}),(0,a.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1",children:[(0,a.jsx)(v.A,{className:"w-4 h-4"}),"Photo"]}),(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.click()},className:"flex items-center gap-1",children:[(0,a.jsx)(y.A,{className:"w-4 h-4"}),"Video"]}),(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:c?()=>{d&&(d.stop(),h(null),o(!1))}:L,className:"flex items-center gap-1 ".concat(c?"bg-red-100 text-red-700":""),children:[(0,a.jsx)(w.A,{className:"w-4 h-4"}),c?"Stop":"Audio"]}),(()=>{switch(R){case"requesting":return(0,a.jsxs)(m,{variant:"outline",size:"sm",disabled:!0,className:"flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 animate-pulse"}),"Getting location..."]});case"granted":return(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:F,className:"flex items-center gap-1 bg-green-50 text-green-700 border-green-200",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),"Update location"]});case"denied":return(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:F,className:"flex items-center gap-1 bg-orange-50 text-orange-700 border-orange-200",children:[(0,a.jsx)(N.A,{className:"w-4 h-4"}),"Try location again"]});case"unavailable":return(0,a.jsxs)(m,{variant:"outline",size:"sm",disabled:!0,className:"flex items-center gap-1 bg-gray-50 text-gray-500",children:[(0,a.jsx)(j.A,{className:"w-4 h-4"}),"Location unavailable"]});default:return(0,a.jsxs)(m,{variant:"outline",size:"sm",onClick:F,className:"flex items-center gap-1",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),"Add location"]})}})()]}),(()=>{switch(R){case"requesting":return(0,a.jsxs)("div",{className:"text-sm text-blue-600 bg-blue-50 p-2 rounded flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 animate-pulse"}),(0,a.jsx)("span",{children:"Requesting your location..."})]});case"granted":return g?(0,a.jsxs)("div",{className:"text-sm text-green-600 bg-green-50 p-2 rounded flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:["Location captured: ",g.lat.toFixed(4),", ",g.lng.toFixed(4)]})]}):null;case"denied":return(0,a.jsxs)("div",{className:"text-sm text-orange-600 bg-orange-50 p-2 rounded flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Location access denied. You can try again or save without location."})]});case"unavailable":return(0,a.jsxs)("div",{className:"text-sm text-gray-600 bg-gray-50 p-2 rounded flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Location services are not available on this device."})]});default:return null}})(),E.length>0&&(0,a.jsx)("div",{className:"space-y-2",children:E.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["photo"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.A,{className:"w-4 h-4"}),(0,a.jsx)("img",{src:e.data||"/placeholder.svg",alt:"Preview",className:"w-8 h-8 object-cover rounded"}),(0,a.jsx)("span",{className:"text-sm",children:"Photo"})]}),"video"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.A,{className:"w-4 h-4"}),(0,a.jsx)("video",{src:e.data,className:"w-8 h-8 object-cover rounded"}),(0,a.jsx)("span",{className:"text-sm",children:"Video"})]}),"audio"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm",children:"Audio Recording"})]})]}),(0,a.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>_(t),className:"text-red-600 hover:text-red-700",children:"Remove"})]},t))}),(0,a.jsxs)(m,{onClick:()=>{(l.trim()||0!==E.length)&&(s?(function(e){let t=S().map(t=>t.id===e.id?e:t);localStorage.setItem(A,JSON.stringify(t))}({...s,text:l.trim(),attachments:E,location:g}),null==r||r()):(function(e){let t=[{...e,id:Date.now().toString(36)+Math.random().toString(36).substr(2)},...S()];localStorage.setItem(A,JSON.stringify(t))}({text:l.trim(),attachments:E,location:g,createdAt:new Date().toISOString()}),t()),i(""),T([]),C(null),k("unknown"))},disabled:!l.trim()&&0===E.length,className:"w-full flex items-center gap-2",children:[(0,a.jsx)(b.A,{className:"w-4 h-4"}),s?"Update Note":"Save Note"]}),s&&(0,a.jsx)(m,{variant:"outline",onClick:()=>{i(""),T([]),C(null),k("unknown"),null==r||r()},className:"w-full flex items-center gap-2",children:"Cancel Edit"})]})}),(0,a.jsx)("input",{ref:z,type:"file",accept:"image/*",capture:"environment",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){let e=new FileReader;e.onload=e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result;T(e=>[...e,{type:"photo",data:a,name:s.name}])},e.readAsDataURL(s)}},className:"hidden"}),(0,a.jsx)("input",{ref:D,type:"file",accept:"video/*",capture:"environment",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(s){let e=new FileReader;e.onload=e=>{var t;let a=null===(t=e.target)||void 0===t?void 0:t.result;T(e=>[...e,{type:"video",data:a,name:s.name}])},e.readAsDataURL(s)}},className:"hidden"})]})}var R=s(9133),k=s(7909);function E(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(null),l=e=>{r(e.id)},i=()=>{r(null),t(S())};(0,n.useEffect)(()=>{t(S())},[]);let c=e=>{!function(e){let t=S().filter(t=>t.id!==e);localStorage.setItem(A,JSON.stringify(t))}(e),t(S())},o=e=>{let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};if(0===e.length)return(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,a.jsx)("p",{children:"No notes yet. Create your first note!"})});if(s){let t=e.find(e=>e.id===s);return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Edit Note"}),(0,a.jsx)(m,{variant:"outline",size:"sm",onClick:()=>r(null),children:"Back to List"})]}),(0,a.jsx)(C,{onNoteCreated:i,editingNote:t,onEditComplete:i})]})}return(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,a.jsx)(u,{children:(0,a.jsxs)(f,{className:"p-4",children:[e.text&&(0,a.jsx)("p",{className:"text-gray-900 mb-3 whitespace-pre-wrap",children:e.text}),e.attachments.length>0&&(0,a.jsx)("div",{className:"space-y-2 mb-3",children:e.attachments.map((e,t)=>(0,a.jsxs)("div",{className:"border rounded p-2",children:["photo"===e.type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(v.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Photo"})]}),(0,a.jsx)("img",{src:e.data||"/placeholder.svg",alt:"Note attachment",className:"max-w-full h-auto rounded"})]}),"video"===e.type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(y.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Video"})]}),(0,a.jsx)("video",{src:e.data,controls:!0,className:"max-w-full h-auto rounded"})]}),"audio"===e.type&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(w.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Audio Recording"})]}),(0,a.jsx)("audio",{src:e.data,controls:!0,className:"w-full"})]})]},t))}),e.location&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),(0,a.jsxs)("span",{children:[e.location.lat.toFixed(6),", ",e.location.lng.toFixed(6)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:o(e.createdAt)}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>l(e),className:"text-blue-600 hover:text-blue-700",children:(0,a.jsx)(R.A,{className:"w-4 h-4"})}),(0,a.jsx)(m,{variant:"ghost",size:"sm",onClick:()=>c(e.id),className:"text-red-600 hover:text-red-700",children:(0,a.jsx)(k.A,{className:"w-4 h-4"})})]})]})]})},e.id))})}let T=n.forwardRef((e,t)=>{let{className:s,type:n,...r}=e;return(0,a.jsx)("input",{type:n,className:o("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t,...r})});T.displayName="Input";var z=s(862);let D=n.forwardRef((e,t)=>{let{className:s,value:n,...r}=e;return(0,a.jsx)(z.bL,{ref:t,className:o("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...r,children:(0,a.jsx)(z.C1,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});D.displayName=z.bL.displayName;var F=s(7917),L=s(4254),_=s(3396),O=s(845),P=s(4858),I=s(7086),M=s(4149),U=s(5997),B=s(3687);function J(e){let{value:t,size:s=200}=e,r=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(!r.current||!t)return;let e=r.current.getContext("2d");if(!e)return;e.fillStyle="white",e.fillRect(0,0,s,s),e.fillStyle="black";let a=s/20;for(let s=0;s<20;s++)for(let n=0;n<20;n++)t.charCodeAt((s+n)%t.length)%3==0&&e.fillRect(s*a,n*a,a,a);let n=3*a;e.fillRect(0,0,n,n),e.fillRect(s-n,0,n,n),e.fillRect(0,s-n,n,n)},[t,s]),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("canvas",{ref:r,width:s,height:s,className:"border border-gray-200 rounded"})})}var q=s(3747),V=s(6482);function W(){let[e,t]=(0,n.useState)(!1),[r,l]=(0,n.useState)(0),[i,c]=(0,n.useState)(!1),o=e=>e.replace(/[<>:"/\\|?*\x00-\x1f]/g,"").replace(/\s+/g,"_").trim(),d=e=>{let t=e.text.slice(0,30).trim()||"note",s=new Date(e.createdAt),a=s.toISOString().split("T")[0],n=s.toTimeString().split(" ")[0].replace(/:/g,"-");return o("".concat(t,"_").concat(a,"_").concat(n))},x=(e,t,s)=>{let a="".concat(e).concat(t),n=1;for(;s.has(a);)a="".concat(e,"_").concat(n).concat(t),n++;return s.add(a),a},p=e=>{var t;let s=e.split(","),a=(null===(t=s[0].match(/:(.*?);/))||void 0===t?void 0:t[1])||"",n=atob(s[1]),r=n.length,l=new Uint8Array(r);for(let e=0;e<r;++e)l[e]=n.charCodeAt(e);return new Blob([l],{type:a})},N=e=>{switch(e.type){case"photo":return".jpg";case"video":return".mp4";case"audio":return".webm";default:return".bin"}},j=e=>{let t=e.text||"(No text content)";t+="\n\n"+"=".repeat(50)+"\n",t+="NOTE METADATA\n",t+="=".repeat(50)+"\n";let s=new Date(e.createdAt);return t+="Created: ".concat(s.toLocaleDateString()," at ").concat(s.toLocaleTimeString(),"\n"),e.location?(t+="Location: ".concat(e.location.lat.toFixed(6),", ").concat(e.location.lng.toFixed(6),"\n"),t+="Google Maps: https://maps.google.com/?q=".concat(e.location.lat,",").concat(e.location.lng,"\n")):t+="Location: Not captured\n",e.attachments.length>0?(t+="\nAttachments (".concat(e.attachments.length,"):\n"),e.attachments.forEach((e,s)=>{t+="- ".concat(e.type," file: ").concat(e.name,"\n")})):t+="\nAttachments: None\n",t},v=async()=>{t(!0),l(0),c(!1);try{let e=S();if(0===e.length){alert("No notes to export!"),t(!1);return}let a=new(await s.e(471).then(s.t.bind(s,6471,23))).default,n=new Set,r=0;for(let t of e){let s=d(t),i=j(t),c=x(s,".txt",n);a.file(c,i),t.attachments.forEach((e,t)=>{let r=N(e),l=x("".concat(s,"_").concat(e.type,"_").concat(t+1),r,n);try{let t=p(e.data);a.file(l,t)}catch(t){console.error("Failed to process attachment ".concat(e.name,":"),t)}}),r++,l(r/e.length*90)}l(95);let i=await a.generateAsync({type:"blob"});l(100);let o=URL.createObjectURL(i),m=document.createElement("a");m.href=o,m.download="notes_export_".concat(new Date().toISOString().split("T")[0],".zip"),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(o),c(!0)}catch(e){console.error("Export failed:",e),alert("Export failed. Please try again.")}finally{t(!1)}};return(0,a.jsxs)(u,{children:[(0,a.jsx)(h,{children:(0,a.jsxs)(g,{className:"flex items-center gap-2",children:[(0,a.jsx)(q.A,{className:"w-5 h-5"}),"Export Notes"]})}),(0,a.jsxs)(f,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Download all your notes as organized text files with media attachments in a ZIP archive."}),(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded space-y-1 text-sm",children:[(0,a.jsx)("p",{className:"font-medium",children:"Export includes:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside space-y-1 text-gray-700",children:[(0,a.jsx)("li",{children:"Individual .txt files for each note"}),(0,a.jsx)("li",{children:"Location data and Google Maps links"}),(0,a.jsx)("li",{children:"All photos, videos, and audio recordings"}),(0,a.jsx)("li",{children:"Export summary with statistics"})]})]}),!e&&!i&&(0,a.jsxs)(m,{onClick:v,className:"w-full flex items-center gap-2",children:[(0,a.jsx)(_.A,{className:"w-4 h-4"}),"Export All Notes (",S().length," notes)"]}),e&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(P.A,{className:"w-4 h-4 animate-spin text-blue-500"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Preparing export..."})]}),(0,a.jsx)(D,{value:r,className:"w-full"}),(0,a.jsxs)("p",{className:"text-xs text-center text-gray-500",children:[r.toFixed(0),"% complete"]})]}),i&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.A,{className:"w-12 h-12 mx-auto text-green-500 mb-3"}),(0,a.jsx)("h3",{className:"font-medium text-green-700",children:"Export Complete!"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Your notes have been downloaded as a ZIP file."})]}),(0,a.jsx)(m,{variant:"outline",onClick:()=>{l(0),c(!1)},className:"w-full",children:"Export Again"})]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 bg-gray-50 p-2 rounded",children:[(0,a.jsx)(V.A,{className:"w-3 h-3 inline mr-1"}),"Files are named using the first 30 characters of each note plus the creation date."]})]})]})}function G(){let[e,t]=(0,n.useState)("idle"),[s,r]=(0,n.useState)("waiting"),[l,i]=(0,n.useState)(""),[c,o]=(0,n.useState)(""),[d,x]=(0,n.useState)(0),[p,N]=(0,n.useState)(null),[j,v]=(0,n.useState)(""),y=(0,n.useRef)(null),w=(0,n.useRef)(null),b=(0,n.useRef)(""),C=()=>Math.random().toString(36).substring(2,8).toUpperCase(),R=()=>{let e=navigator.userAgent;return/iPhone|iPad|iPod/.test(e)?"iPhone":/Android/.test(e)?"Android":/Mac/.test(e)?"Mac":/Windows/.test(e)?"Windows":"Device"},k=e=>{let t=new Blob([JSON.stringify(e)]).size;return t<1024?"".concat(t," B"):t<1048576?"".concat((t/1024).toFixed(1)," KB"):"".concat((t/1048576).toFixed(1)," MB")},E=()=>{let e=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});return e.oniceconnectionstatechange=()=>{console.log("ICE connection state:",e.iceConnectionState),"connected"===e.iceConnectionState?r("connected"):"failed"===e.iceConnectionState&&(r("error"),v("Connection failed. Please try again."))},e},z=async()=>{try{t("sending"),r("waiting"),v("");let e=C();i(e);let s=E();y.current=s;let a=s.createDataChannel("notes-transfer",{ordered:!0});a.onopen=()=>{console.log("Data channel opened"),r("connected")},a.onclose=()=>{console.log("Data channel closed")},w.current=a;let n=await s.createOffer();await s.setLocalDescription(n),console.log("Offer created, waiting for answer...")}catch(e){r("error"),v("Failed to start sending mode"),console.error(e)}},q=async()=>{try{t("receiving"),r("waiting"),v("");let e=E();y.current=e,e.ondatachannel=e=>{let t=e.channel;w.current=t,t.onopen=()=>{console.log("Received data channel opened"),r("connected")},t.onmessage=e=>{V(e.data)},t.onclose=()=>{console.log("Received data channel closed")}}}catch(e){r("error"),v("Failed to start receiving mode"),console.error(e)}},V=e=>{try{if("TRANSFER_START"===e){r("transferring"),x(0),b.current="";return}if("TRANSFER_END"===e){let e=JSON.parse(b.current);"notes-transfer"===e.type&&(!function(e){let t=S(),s=new Set(t.map(e=>e.id)),a=e.filter(e=>!s.has(e.id));if(a.length>0){let e=[...a,...t];localStorage.setItem(A,JSON.stringify(e))}}(e.notes),N({deviceName:e.deviceName,notesCount:e.notes.length,totalSize:k(e.notes)}),r("completed"),x(100));return}b.current+=e,x(e=>Math.min(e+10,90))}catch(e){r("error"),v("Failed to process received data"),console.error(e)}},G=async()=>{if(!w.current||"open"!==w.current.readyState){v("Connection not ready");return}try{r("transferring"),x(0);let e=S(),t={type:"notes-transfer",notes:e,totalSize:new Blob([JSON.stringify(e)]).size,deviceName:R()},s=JSON.stringify(t);w.current.send("TRANSFER_START");let a=Math.ceil(s.length/16384);for(let e=0;e<a;e++){let t=16384*e,n=Math.min(t+16384,s.length),r=s.slice(t,n);w.current.send(r),x((e+1)/a*90),await new Promise(e=>setTimeout(e,10))}w.current.send("TRANSFER_END"),N({deviceName:"Receiving Device",notesCount:e.length,totalSize:k(e)}),r("completed"),x(100)}catch(e){r("error"),v("Failed to send notes"),console.error(e)}};return"idle"===e?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)(u,{children:[(0,a.jsx)(h,{children:(0,a.jsxs)(g,{className:"flex items-center gap-2",children:[(0,a.jsx)(F.A,{className:"w-5 h-5"}),"Transfer Notes"]})}),(0,a.jsxs)(f,{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Transfer all your notes securely between devices using direct peer-to-peer connection."}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,a.jsxs)(m,{onClick:z,className:"flex items-center gap-2 h-12",children:[(0,a.jsx)(L.A,{className:"w-4 h-4"}),"Send Notes to Another Device"]}),(0,a.jsxs)(m,{variant:"outline",onClick:q,className:"flex items-center gap-2 h-12",children:[(0,a.jsx)(_.A,{className:"w-4 h-4"}),"Receive Notes from Another Device"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500 bg-blue-50 p-3 rounded",children:[(0,a.jsx)(O.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:"Transfers are encrypted and direct between devices"})]})]})]}),(0,a.jsx)(W,{})]}):(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)(u,{children:[(0,a.jsx)(h,{children:(0,a.jsxs)(g,{className:"flex items-center gap-2",children:["sending"===e?(0,a.jsx)(L.A,{className:"w-5 h-5"}):(0,a.jsx)(_.A,{className:"w-5 h-5"}),"sending"===e?"Sending Notes":"Receiving Notes"]})}),(0,a.jsxs)(f,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["waiting"===s&&(0,a.jsx)(P.A,{className:"w-4 h-4 animate-spin text-blue-500"}),"connected"===s&&(0,a.jsx)(I.A,{className:"w-4 h-4 text-green-500"}),"transferring"===s&&(0,a.jsx)(P.A,{className:"w-4 h-4 animate-spin text-blue-500"}),"completed"===s&&(0,a.jsx)(I.A,{className:"w-4 h-4 text-green-500"}),"error"===s&&(0,a.jsx)(M.A,{className:"w-4 h-4 text-red-500"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:["waiting"===s&&"Waiting for connection...","connected"===s&&"Connected successfully","transferring"===s&&"Transferring data...","completed"===s&&"Transfer completed!","error"===s&&"Connection error"]})]}),"sending"===e&&"waiting"===s&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center space-y-3",children:[(0,a.jsx)("div",{className:"bg-gray-100 p-4 rounded-lg",children:(0,a.jsx)(J,{value:l,size:150})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Connection Code:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(T,{value:l,readOnly:!0,className:"text-center text-lg font-mono"}),(0,a.jsx)(m,{size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(l)},children:(0,a.jsx)(U.A,{className:"w-4 h-4"})})]})]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 text-center",children:"Scan the QR code or enter the connection code on the receiving device"})]}),"receiving"===e&&"waiting"===s&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(B.A,{className:"w-12 h-12 mx-auto text-gray-400 mb-3"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Enter the connection code from the sending device"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(T,{placeholder:"Enter 6-digit code",value:c,onChange:e=>o(e.target.value.toUpperCase()),className:"text-center text-lg font-mono",maxLength:6}),(0,a.jsx)(m,{onClick:()=>{6===c.length&&(r("connecting"),setTimeout(()=>{r("connected")},2e3))},disabled:6!==c.length,className:"w-full",children:"Connect"})]})]}),"connected"===s&&"sending"===e&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.A,{className:"w-12 h-12 mx-auto text-green-500 mb-3"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Device connected! Ready to send ",S().length," notes."]})]}),(0,a.jsx)(m,{onClick:G,className:"w-full",children:"Start Transfer"})]}),"transferring"===s&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(P.A,{className:"w-8 h-8 mx-auto animate-spin text-blue-500 mb-2"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"sending"===e?"Sending notes...":"Receiving notes..."})]}),(0,a.jsx)(D,{value:d,className:"w-full"}),(0,a.jsxs)("p",{className:"text-xs text-center text-gray-500",children:[d.toFixed(0),"% complete"]})]}),"completed"===s&&p&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(I.A,{className:"w-12 h-12 mx-auto text-green-500 mb-3"}),(0,a.jsx)("h3",{className:"font-medium text-green-700",children:"Transfer Successful!"})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded space-y-1",children:[(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Device:"})," ",p.deviceName]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Notes:"})," ",p.notesCount]}),(0,a.jsxs)("p",{className:"text-sm",children:[(0,a.jsx)("strong",{children:"Size:"})," ",p.totalSize]})]})]}),"error"===s&&(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(M.A,{className:"w-12 h-12 mx-auto text-red-500 mb-3"}),(0,a.jsx)("p",{className:"text-sm text-red-600",children:j})]})}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4 border-t",children:[(0,a.jsx)(m,{variant:"outline",onClick:()=>{y.current&&(y.current.close(),y.current=null),w.current&&(w.current.close(),w.current=null),t("idle"),r("waiting"),i(""),o(""),x(0),N(null),v(""),b.current=""},className:"flex-1",children:"completed"===s?"Done":"Cancel"}),"error"===s&&(0,a.jsx)(m,{onClick:()=>"sending"===e?z():q(),className:"flex-1",children:"Try Again"})]})]})]})})}var H=s(423),Q=s(4712);function X(){let[e,t]=(0,n.useState)("compose"),[s,r]=(0,n.useState)(0);return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-lg font-semibold text-gray-900",children:"Notes"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(m,{variant:"compose"===e?"default":"outline",size:"sm",onClick:()=>t("compose"),className:"flex items-center gap-1",children:[(0,a.jsx)(H.A,{className:"w-4 h-4"}),"New"]}),(0,a.jsxs)(m,{variant:"list"===e?"default":"outline",size:"sm",onClick:()=>t("list"),className:"flex items-center gap-1",children:[(0,a.jsx)(Q.A,{className:"w-4 h-4"}),"Browse"]}),(0,a.jsxs)(m,{variant:"transfer"===e?"default":"outline",size:"sm",onClick:()=>t("transfer"),className:"flex items-center gap-1",children:[(0,a.jsx)(F.A,{className:"w-4 h-4"}),"Transfer"]})]})]}),(0,a.jsxs)("div",{className:"p-4",children:["compose"===e&&(0,a.jsx)(C,{onNoteCreated:()=>{r(e=>e+1)}}),"list"===e&&(0,a.jsx)(E,{},s),"transfer"===e&&(0,a.jsx)(G,{})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[621,535,542,358],()=>t(305)),_N_E=e.O()}]);